# Makefile.in COPYRIGHT FUJITSU LIMITED 2015-2016
CC=@CC@
BINDIR=@BINDIR@
KDIR ?= @KDIR@
CFLAGS=-Wall -O -I.
VPATH=@abs_srcdir@
TARGET=mcexec
@uncomment_if_ENABLE_MEMDUMP@TARGET+=eclair
LIBS=@LIBS@
IHKDIR ?= $(VPATH)/../../../ihk/linux/include/
ARCH=@ARCH@

CFLAGS += $(foreach i, $(shell seq 1 100), $(addprefix -DPOSTK_DEBUG_ARCH_DEP_, $(i)))
CFLAGS += $(foreach i, $(shell seq 1 100), $(addprefix -DPOSTK_DEBUG_TEMP_FIX_, $(i)))

all: $(TARGET)

mcexec: mcexec.c
	$(CC) -I${KDIR} $(CFLAGS) $(EXTRA_CFLAGS) -fPIE -pie -lrt -lnuma -pthread -o $@ $^ $(EXTRA_OBJS)

eclair: eclair.c arch/$(ARCH)/arch-eclair.c
	$(CC) -I.. -I. -I./arch/$(ARCH)/include -I${IHKDIR} $(CFLAGS) -o $@ $^ $(LIBS)

clean:
	$(RM) $(TARGET) *.o

.PHONY: all clean install

install:
	mkdir -p -m 755 $(BINDIR)
	install -m 755 mcexec $(BINDIR)
	@uncomment_if_ENABLE_MEMDUMP@install -m 755 eclair $(BINDIR)

